<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shotcut icon" href="../../../../../Documentação/Logos/favicon.png">
	<title>Best Streaming</title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="assets/materialize/css/materialize.min.css" media="screen,projection" />
	<link rel="apple-touch-icon" sizes="57x57" href="../../Images/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="../../Images/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="../../Images/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../../Images/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="../../Images/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../../Images/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="../../Images/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../../Images/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../../Images/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="../../Images/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../Images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../../Images/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../Images/favicon/favicon-16x16.png">

	<!-- Bootstrap Styles-->
	<link href="assets/css/bootstrap.css" rel="stylesheet" />
	<!-- FontAwesome Styles-->
	<link href="assets/css/font-awesome.css" rel="stylesheet" />
	<!-- Morris Chart Styles-->
	<link href="assets/js/morris/morris-0.4.3.min.css" rel="stylesheet" />
	<!-- Custom Styles-->
	<link href="assets/css/custom-styles.css" rel="stylesheet" />
	<!-- Google Fonts-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
	<link rel="stylesheet" href="assets/js/Lightweight-Chart/cssCharts.css">
	<!-- scripts do Chart.js -->
	<script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
	<script type="text/javascript" src="https://www.chartjs.org/samples/latest/utils.js"></script>
	
</head>

<body onload="iniciar()">
	<div id="wrapper">
		<nav class="navbar navbar-default top-navbar" role="navigation">
			<div class="navbar-header">
				<Img src="../images/bs.png" style="width: 150px;"></Img>

				<div class="botoes">
						<a href="index.html"><div class="bt1"><i class="fa fa-user fa-fw"></i>Dashboard</div></a>
					<a href="https://bandteccom.sharepoint.com/:u:/s/BStreaming/EUUWCafuNXhNt0PTVThKIHEBrUYI9m871Gz3X4EsTh_3kw?e=mEf0Vb"><div class="bt2"><i class="fa fa-user fa-fw" style="text-align: center;"></i>Mais detalhes</div></a>
				</div>


			</div>

			<ul class="nav navbar-top-links navbar-right" style="background:#fdcc34;">

				<li><a class="dropdown-button waves-effect waves-dark text-white" href="#!" data-activates="dropdown1">
					<i class="fa fa-user fa-fw text-white"></i> <b id="nomeUsuario">Usuário</b> 
					<i class="material-icons right">arrow_drop_down</i></a></li>
			</ul>
		</nav>
		<!-- Dropdown Structure -->
		<ul id="dropdown1" class="dropdown-content">
			<li><a href="perfil.html"><i class="fa fa-user fa-fw"></i> Perfil</a>
			</li>
			<li><a onclick="logout()"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
			</li>
		</ul>
		<!--/. NAV TOP  -->
		<!-- /. NAV SIDE  -->
		
		<center>
				<!-- /. ROW  -->
				

				<div class="col-xs-12 col-sm-6 col-md-4" style="margin-top: 150px;">
					<div class="card-panel text-center" style="background:#320072 ;">
						<h4 style="color: white;">CPU</h4>
						<h2 id="cpuData"  style="color: white;">...%</h2>
						<canvas id="cpuGraph"></canvas>
					</div>
				</div>

				<div class="row" style="width: 100%">
					<div class="col-xs-12 col-sm-6 col-md-4" style="margin-top: 150px;">
						<div class="card-panel text-center" style="background:#320072 ;">
							<h4  style="color: white;">MEMÓRIA RAM</h4>
							<h2 id="ramData"  style="color: white;">...%</h2>
							<canvas id="ramGraph"></canvas>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4" style="margin-top: 150px;">
						<div class="card-panel text-center" style="background:#320072 ;">
							<h4  style="color: white;">DISCO</h4>
							<h2 id="diskData"  style="color: white;">...%</h2>
							<canvas id="diskGraph"></canvas>
						</div>
					</div>
				</div>

				<div id="page-inner">
					<div class="row">
						<div style="width: 100%; height: 10%;">
							<div class="card" style="background:#320072 ;">
								<canvas id="lineGraph"></canvas>
							</div>
						</div>
					</div>
				</div>

				
	</div>
	<div class="alerta1"></div>

	</center>

	<!-- /. WRAPPER  -->
	<!-- JS Scripts-->
	<!-- jQuery Js -->
	<script src="assets/js/jquery-1.10.2.js"></script>

	<!-- Bootstrap Js -->
	<script src="assets/js/bootstrap.min.js"></script>

	<script src="assets/materialize/js/materialize.min.js"></script>

	<!-- Metis Menu Js -->
	<script src="assets/js/jquery.metisMenu.js"></script>
	<!-- Morris Chart Js -->
	<script src="assets/js/morris/raphael-2.1.0.min.js"></script>
	<script src="assets/js/morris/morris.js"></script>


	<script src="assets/js/easypiechart.js"></script>
	<script src="js/easypiechart-data.js"></script>

	<script src="assets/"></script>

	<!-- Custom Js -->
	<script src="assets/js/custom-scripts.js"></script>
	    <script src="assets/js/moment.min.js"></script>
	

	



</body>

</html>

<script type="text/javascript" src="../js/auth.js"></script>

<script type="text/javascript">
	verificarSessao();
	const nome = sessionStorage.getItem("nomeUsuario").split(" ");
	document.getElementById("nomeUsuario").innerHTML = nome[0];

	const id = sessionStorage.getItem("id");

		// <![CDATA[
		var ttChatLoaderS = document.createElement('script');
		document.tomticketChatLoaderScriptVersion = 2;
		ttChatLoaderS.src = 'https://next-streaming.tomticket.com/scripts-chat/chat.min.js' +
			'?id=EP36441' +
			'&account=2332224P30102019081549' +
			'&autoOpen=0' +
			'&hideWhenOffline=0' +
			'&d=next-streaming' +
			'&ts=' + new Date().getTime() +
			'&ref=' + encodeURIComponent(document.URL);
		document.body.appendChild(ttChatLoaderS);
		//]]>

function iniciar(){
	getAtual();
	getGraph();
	setTimeout(iniciar,5*1000)
}



	function getAtual() {
		let URL = `https://backend-nextstreaming.azurewebsites.net/api/monitoramento/lastReg/${id}`;
		var xhttp = new XMLHttpRequest();

		xhttp.onreadystatechange = function () {
			if (this.readyState == 4 && this.status == 200) {
				resposta = JSON.parse(xhttp.responseText);

				document.getElementById("cpuData").innerHTML =
					`${resposta.data[0].cpu == null ? 0 : Math.round((resposta.data[0].cpu/resposta.data[0].maquina.cpu)*100)}%`
				document.getElementById("ramData").innerHTML =
					`${resposta.data[0].ram == null ? 0 : Math.round((resposta.data[0].ram/resposta.data[0].maquina.ram)*100)}%`
				document.getElementById("diskData").innerHTML =
					`${resposta.data[0].disco == null ? 0 : Math.round((resposta.data[0].disco/resposta.data[0].maquina.disco)*100)}%`
				var ctx = document.getElementById('cpuGraph').getContext('2d');
				var cpuGraph = new Chart(ctx, {
					type: 'doughnut',
					data: {
						labels: ['Consumo', 'Livre'],
						datasets: [{
							data: [resposta.data[0].cpu, resposta.data[0].maquina.cpu - resposta.data[
								0].cpu],
							backgroundColor: [
								'rgba(255, 0, 0)'
							],
							borderWidth: 1
						}]
					}
				});


				var ctx = document.getElementById('ramGraph').getContext('2d');
				var ramGraph = new Chart(ctx, {
					type: 'doughnut',
					data: {
						labels: ['Consumo', 'Livre'],
						datasets: [{
							data: [resposta.data[0].ram, resposta.data[0].maquina.ram - resposta.data[
								0].ram],
							backgroundColor: [
								'rgba(0, 255, 26)'
							],
							borderWidth: 1
						}]
					}
				});

				var ctx = document.getElementById('diskGraph').getContext('2d');
				var diskGraph = new Chart(ctx, {
					type: 'doughnut',
					data: {
						labels: ['Consumo', 'Livre'],
						datasets: [{
							data: [resposta.data[0].disco, resposta.data[0].maquina.disco - resposta
								.data[0].disco
							],
							backgroundColor: [
								'rgba(255, 166, 0)'
							],
							borderWidth: 1
						}]
					}
				});
			}
		};

		xhttp.open("GET", URL, true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send();
	}

	function getGraph() {
        let URL = `https://backend-nextstreaming.azurewebsites.net/api/monitoramento/lastTen/${id}`;
        var xhttp = new XMLHttpRequest();

        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                resposta = JSON.parse(xhttp.responseText);
                let datasLabel = [];
                let cpu = [];
                let ram = [];
                let disk = [];
                resposta.data.forEach(element => {
                    datasLabel.push(moment(element.dataHora).format('DD/MM/YYYY, hh:mm:ss'));
                    cpu.push(element.cpu);
                    ram.push(element.ram);
                    disk.push(element.disco);
                });
                const corCpu = 'rgba(255, 0, 0)';
                const corRam = 'rgba(0, 255, 26)';
                const corDisco = 'rgba(255, 166, 0)';
                var ctx = document.getElementById('lineGraph').getContext('2d');
                var lineGraph = new Chart(ctx, {
                    type: 'horizontalBar',
                    data: {
                        labels: datasLabel,
                        datasets: [{
                                label: 'CPU',
                                data: cpu,
                                backgroundColor: corCpu,
                                borderColor: corCpu,
                                hoverborderColor: corCpu,
                                hoverBackgroundColor: corCpu,
                                borderWidth: 1,
                            },
                            {
                                label: 'RAM',
                                data: ram,
                                backgroundColor: corRam,
                                borderColor: corRam,
                                hoverborderColor: corRam,
                                hoverBackgroundColor: corRam,
                                borderWidth: 1,
                            },
                            {
								label: 'DISCO',
                                data: disk,
                                backgroundColor: corDisco,
                                borderColor: corDisco,
                                hoverborderColor: corDisco,
                                hoverBackgroundColor: corDisco,
                                borderWidth: 1,
                            }
                        ],
                    }
                });
            }
        }
        xhttp.open("GET", URL, true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send();
    }

</script>
